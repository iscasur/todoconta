---
import { getCollection, getEntry } from 'astro:content';
import ServiceLayout from '../../layouts/ServiceLayout.astro';
import Hero from '../../components/service/Hero.astro';
import Features from '../../components/service/Features.astro';
import PricingCard from '../../components/service/PricingCard.astro';
import Categories from '../../components/service/Categories.astro';
import Testimonials from '../../components/service/Testimonials.astro';
import Process from '../../components/service/Process.astro';
import Stats from '../../components/service/Stats.astro';
import FAQ from '../../components/service/FAQ.astro';
import CTA from '../../components/service/CTA.astro';

// Genera rutas para cada servicio
export async function getStaticPaths() {
  const services = await getCollection('services');
  
  return services.map(service => ({
    params: { slug: service.slug },
    props: { service }
  }));
}

const { service } = Astro.props;
const { 
  title, 
  description, 
  monthlyPrice, 
  yearlyPrice,
  savings,
  priceNote,
  badge,
  featured,
  recommendedFor,
  heroImage,
  ctaText,
  ctaUrl,
  secondaryCtaText,
  secondaryCtaUrl,
  includedFeatures,
  categories,
  testimonials,
  faqs,
  process,
  stats
} = service.data;
---

<ServiceLayout title={title} description={description}>
  <!-- Hero Section -->
  <Hero
    title={title}
    description={description}
    badge={badge}
    recommendedFor={recommendedFor}
    image={heroImage}
    primaryCta={{text: ctaText, url: ctaUrl}}
    secondaryCta={secondaryCtaText && secondaryCtaUrl ? {text: secondaryCtaText, url: secondaryCtaUrl} : null}
    includedFeatures={includedFeatures}
  />

  <!-- Pricing Section -->
  <section class="pricing-section">
    <div class="container">
      <h2 class="section-title text-center">Inversión</h2>
      <PricingCard
        monthlyPrice={monthlyPrice}
        yearlyPrice={yearlyPrice}
        savings={savings}
        priceNote={priceNote}
        featured={featured}
        includedFeatures={includedFeatures}
        ctaText={ctaText}
        ctaUrl={ctaUrl}
      />
    </div>
  </section>
  
  <!-- Categories Section -->
  {categories && categories.length > 0 && (
    <Categories categories={categories} />
  )}
  
  <!-- Testimonials Section -->
  {testimonials && testimonials.length > 0 && (
    <Testimonials testimonials={testimonials} />
  )}
  
  <!-- Process Section -->
  {process && process.length > 0 && (
    <Process steps={process} />
  )}
  
  <!-- Stats Section -->
  {stats && stats.length > 0 && (
    <Stats stats={stats} />
  )}
  
  <!-- FAQ Section -->
  {faqs && faqs.length > 0 && (
    <FAQ faqs={faqs} />
  )}
  
  <!-- Call to Action -->
  <CTA
    title={`¿Listo para comenzar con nuestro ${title}?`}
    description="Contrata ahora y obtén el mejor servicio contable para tu negocio."
    primaryCta={{text: ctaText, url: ctaUrl}}
    secondaryCta={secondaryCtaText && secondaryCtaUrl ? {text: secondaryCtaText, url: secondaryCtaUrl} : null}
  />
</ServiceLayout>