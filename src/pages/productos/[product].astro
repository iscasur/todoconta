---
// src/pages/landing/[product].astro
import { getCollection } from 'astro:content';
import LandingLayout from '../../layouts/LandingLayout.astro';
import Hero from '../../components/landing/Hero.astro';
import Features from '../../components/landing/Features.astro';
import Benefits from '../../components/landing/Benefits.astro';
import Pricing from '../../components/landing/Pricing.astro';
import Demo from '../../components/landing/Demo.astro';
import FAQ from '../../components/landing/FAQ.astro';
import CTA from '../../components/landing/CTA.astro';

// Genera rutas para cada producto
export async function getStaticPaths() {
  const products = await getCollection('products');

  return products.map(product => ({
    params: { product: product.slug },
    props: { product },
  }));
}

const { product } = Astro.props;
const {
  title,
  description,
  price,
  pricePeriod,
  badge,
  heroImage,
  demoUrl,
  buyUrl,
  features,
  benefits,
  pricing,
  faqs,
  formId,
} = product.data;

// Prepara los datos para los componentes
const heroProps = {
  title,
  subtitle: description,
  primaryCta: {
    text: 'Comprar Ahora',
    url: '#pricing',
  },
  ...(badge && { badge }),
  ...(demoUrl && {
    secondaryCta: {
      text: 'Descargar Demo',
      url: '#demo',
    },
  }),
  ...(heroImage && { image: heroImage }),
};

const featuresProps = {
  title: 'Funciones Principales',
  subtitle: `${title} ofrece potentes herramientas para optimizar tu trabajo.`,
  features,
};

const benefitsProps = {
  title: 'Beneficios para tu Negocio',
  subtitle: `${title} está diseñado para optimizar tus procesos.`,
  benefits,
};

const pricingProps = {
  price,
  features: pricing.features,
  ctaUrl: buyUrl || '#',
  highlighted: true,
  ...(pricePeriod && { pricePeriod }),
};

const demoProps =
  demoUrl && formId
    ? {
        demoUrl,
        formId,
      }
    : null;

const ctaProps = {
  title: `¿Listo para optimizar tu trabajo con ${title}?`,
  description:
    'Únete a miles de profesionales que confían en nuestras soluciones para gestionar sus procesos de manera eficiente.',
  primaryCta: {
    text: 'Comprar Ahora',
    url: buyUrl || '#pricing',
  },
  ...(demoUrl && {
    secondaryCta: {
      text: 'Probar Demo Gratis',
      url: '#demo',
    },
  }),
};

// Keywords para SEO
const keywords = [
  title.split(' ').join(', '),
  ...features.map(f => f.title),
  ...benefits.map(b => b.title),
  'Todoconta',
  'software contable',
  'herramientas fiscales',
];

// Verificar que todas las propiedades necesarias estén disponibles
const hasValidFeatures =
  features && Array.isArray(features) && features.length > 0;
const hasValidBenefits =
  benefits && Array.isArray(benefits) && benefits.length > 0;
const hasValidPricing =
  pricing && pricing.features && Array.isArray(pricing.features);
const hasValidFaqs = faqs && Array.isArray(faqs) && faqs.length > 0;
---

<LandingLayout
  title={title}
  description={description}
  keywords={keywords}
  {...heroImage && { ogImage: heroImage }}
>
  <!-- Hero Section -->
  <Hero {...heroProps} />

  <!-- Features Section -->
  {hasValidFeatures && <Features {...featuresProps} />}

  <!-- Benefits Section -->
  {hasValidBenefits && <Benefits {...benefitsProps} />}

  <!-- Pricing Section -->
  {hasValidPricing && <Pricing {...pricingProps} />}

  <!-- Demo Section (if available) -->
  {demoProps && <Demo {...demoProps} />}

  <!-- FAQ Section (if available) -->
  {hasValidFaqs && <FAQ faqs={faqs} />}

  <!-- Call to Action -->
  <CTA {...ctaProps} />
</LandingLayout>
