---
// src/pages/landing/[product].astro
import { getCollection } from 'astro:content';
import LandingLayout from '../../layouts/LandingLayout.astro';
import Hero from '../../components/landing/Hero.astro';
import Features from '../../components/landing/Features.astro';
import Benefits from '../../components/landing/Benefits.astro';
import Pricing from '../../components/landing/Pricing.astro';
import Demo from '../../components/landing/Demo.astro';
import FAQ from '../../components/landing/FAQ.astro';
import CTA from '../../components/landing/CTA.astro';

// Genera rutas para cada producto
export async function getStaticPaths() {
  const products = await getCollection('products');

  return products.map(product => ({
    params: { product: product.slug },
    props: { product },
  }));
}

const { product } = Astro.props;
const {
  title,
  description,
  price,
  pricePeriod,
  badge,
  heroImage,
  demoUrl,
  buyUrl,
  features,
  benefits,
  pricing,
  faqs,
  formId,
} = product.data;

// Prepara los datos para los componentes
const heroProps = {
  title,
  subtitle: description,
  badge,
  primaryCta: {
    text: 'Comprar Ahora',
    url: '#pricing',
  },
  secondaryCta: demoUrl
    ? {
        text: 'Descargar Demo',
        url: '#demo',
      }
    : undefined,
  image: heroImage,
};

const featuresProps = {
  title: 'Funciones Principales',
  subtitle: `${title} ofrece potentes herramientas para optimizar tu trabajo.`,
  features,
};

const benefitsProps = {
  title: 'Beneficios para tu Negocio',
  subtitle: `${title} está diseñado para optimizar tus procesos.`,
  benefits,
};

const pricingProps = {
  price,
  pricePeriod,
  features: pricing.features,
  ctaUrl: buyUrl || '#',
  highlighted: true,
};

const demoProps =
  demoUrl && formId
    ? {
        demoUrl,
        formId,
      }
    : null;

const ctaProps = {
  title: `¿Listo para optimizar tu trabajo con ${title}?`,
  description:
    'Únete a miles de profesionales que confían en nuestras soluciones para gestionar sus procesos de manera eficiente.',
  primaryCta: {
    text: 'Comprar Ahora',
    url: buyUrl || '#pricing',
  },
  secondaryCta: demoUrl
    ? {
        text: 'Probar Demo Gratis',
        url: '#demo',
      }
    : undefined,
};

// Keywords para SEO
const keywords = [
  title.split(' ').join(', '),
  ...features.map(f => f.title),
  ...benefits.map(b => b.title),
  'Todoconta',
  'software contable',
  'herramientas fiscales',
];

// Verificar que todas las propiedades necesarias estén disponibles
const hasValidFeatures =
  features && Array.isArray(features) && features.length > 0;
const hasValidBenefits =
  benefits && Array.isArray(benefits) && benefits.length > 0;
const hasValidPricing =
  pricing && pricing.features && Array.isArray(pricing.features);
const hasValidFaqs = faqs && Array.isArray(faqs) && faqs.length > 0;
---

<LandingLayout
  title={title}
  description={description}
  keywords={keywords}
  ogImage={heroImage}
>
  <!-- Hero Section -->
  <Hero {...heroProps} />

  <!-- Features Section -->
  {hasValidFeatures && <Features {...featuresProps} />}

  <!-- Benefits Section -->
  {hasValidBenefits && <Benefits {...benefitsProps} />}

  <!-- Pricing Section -->
  {hasValidPricing && <Pricing {...pricingProps} />}

  <!-- Demo Section (if available) -->
  {demoProps && <Demo {...demoProps} />}

  <!-- FAQ Section (if available) -->
  {hasValidFaqs && <FAQ faqs={faqs} />}

  <!-- Call to Action -->
  <CTA {...ctaProps} />
</LandingLayout>

<style is:global>
  /* Estilos adicionales específicos para esta página */
  .landing-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 var(--space-4);
  }

  /* Animaciones */
  .animate-fade-in-up {
    opacity: 0;
    transform: translateY(20px);
    transition:
      opacity 0.6s ease,
      transform 0.6s ease;
  }

  .animate-fade-in-up.visible {
    opacity: 1;
    transform: translateY(0);
  }

  .delay-100 {
    transition-delay: 100ms;
  }
  .delay-200 {
    transition-delay: 200ms;
  }
  .delay-300 {
    transition-delay: 300ms;
  }
  .delay-400 {
    transition-delay: 400ms;
  }
</style>
